<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html>
<head>
    <title>Measurements</title>
    <link rel="stylesheet" type="text/css" href="styles/main.css">
    <script src="scripts/topButton.js"></script>
    <button onclick="topFunction()" id="topButton" title="Back to top">Back to top</button>
</head>
<body id="_top">

<center><a href="https://cliniface.org"><img src="images/cface.svg" alt="Cliniface Logo" style="width:27%;"/></a></center>
<center><h1>Measurements</h1></center>
<hr>
This page details the placement of landmarks and the measurement and analysis of facial features. In most
cases, the initial step is to detect and place landmarks on the subject's face. This process is described
in the following section, with subsequent sections describing other aspects of the measurement process.
<ul>
<li><a href="#landmarks">Landmark Placement</a></li>
<li><a href="#assessment_info">Subject Demographics</a></li>
<li><a href="#_hpo_browser">Human Phenotype Ontology (HPO) Browser</a></li>
<li><a href="#_measurements_browser">Measurements Browser</a></li>
<li><a href="#_metric_types">Metric Types </a></li>
<li><a href="#_calliper_measurements">Calliper Measurements</a></li>
</ul>

<h2 id="landmarks">Landmark Placement</h2>
<p>The facial measurements collected by Cliniface require accurate placement of anatomical landmarks.
Upon selecting the face detection function, Cliniface tries to align and match its 3D morphable model (3DMM)
to the selected face. A set of predefined landmarks on the 3DMM are transfered to the target face allowing for
anthropometric correspondence between faces. The accuracy of the registration process can be
changed through Cliniface's <a href="preferences.html">preferences</a>. The default parameters have
been optimised to give acceptable processing speed at a good level of accuracy.
After registration, Procrustes superimposition with the template 3DMM aligns
the subject's face into standard upright pose (close to the Frankfort horizontal plane pose).
</p>
<p>Once Cliniface has placed the landmarks according to the result of automatic mask registration,
two dialogs are displayed. The <em>Landmarks Browser</em> (shown below) prompts for confirmation of
the positions of the newly placed landmarks.
</p>
<center><img src="images/landmarks_dialog.png"/></center>
<p>While this dialog is displayed, landmarks can be moved into different positions by clicking and dragging them
around the facial surface within the main viewer. Clicking and dragging anywhere else moves the camera as
normal. As each landmark is hovered over, the image and the description in the dialog changes
to show how it should be placed.
</p>
<p>Some functions are available from this dialog that are not available elsewhere and these are found in the
bottom left corner of the <em>Landmarks Browser</em>. From left to right, these are:
</p>
<h3>Show Landmark Labels</h3>
<p style="margin-left: 40px">Toggle on/off all landmark labels (including non-visible landmarks
- though this will likely change for later releases).
</p>
<h3>Make Landmarks Symmetric</h3>
<p style="margin-left: 40px">Force a laterally symmetric positioning of landmarks. This should not be
used ordinarily unless using Cliniface to produce a new template mask with landmark positions. This function
centres medial landmarks in the YZ plane, and positions the landmarks in the subject's left lateral
as a reflection through this plane of the right lateral landmarks.
</p>
<h3>Restore Landmarks</h3>
<p style="margin-left: 40px">Restore landmarks to their originally detected positions.
</p>

<h2 id="assessment_info">Subject Demographics</h2>
<p>The second dialog displayed after registration is the <em>Assessment Information</em> dialog (shown below).
This demographic information to be entered about the subject. For Cliniface to assess the significance of
facial measurements, they must be compared against expected patterns of growth over time matched to sex and
ethnicity. The subject's date of birth and date of
image capture must be entered to determine the age at time of imaging. Maternal and paternal ethnicity
and sex should be selected from the dropdown lists.
</p>
<p>Other information not essential for Cliniface's automated analysis can also be entered here. This includes
any meaningful observations, the identity of the assessor, as well as the source of the image
(the meaning of this is up to the user e.g., capture hardware used, or institution responsible for the imaging),
and any study or project identifier associated with the image.
</p>
<center><img src="images/bella_raw_ass_info.png"/></center>
<h3>Multiple Assessors per Image</h3>
<p>Information from multiple assessors can be recorded against the same image. Each assessor can be selected from the
dropdown <em>Assessor</em> list. If an image has multiple assessors, the currently selected assessor is shown in
square brackets next to the filepath in the titlebar of Cliniface's main window. All metadata for an image is
shared between assessors <em>except for</em> the assessor's notes, the positions of facial landmarks, and any
custom measurements (see below). To change the name of the assessor (initially "Unknown") simply edit the name
directly and click <em>Apply</em> or <em>OK</em>. To add an assessor, click the green plus symbol
to the right of the <em>Assessor</em> dropdown list. The new assessor's name is "Unknown" and the landmark positions
and calliper measurements from the previously selected assessor are copied over (with a note made about this
in the <em>Assessor's notes</em> field). If there's more than one assessor for the image, delete the one that's
currently selected by clicking the red cross. To make the landmarks positions
for all assessors the same as for the currently selected assessor, click the button on the far right with the landmark
icon to copy the landmarks across to all the other assessors. Direct edits to landmark positions (made when the
<em>Landmarks Brower</em> is displayed) only apply to the landmarks stored against the currently selected assessor.
However, changes to the underlying facial surface model cause landmark positions to change for <em>all</em> assessors.
</p>
<p>At the bottom of the <em>Assessment Information</em> dialog is a list of any currently detected
dysmorphologic traits. This list updates whenever the subject's demographic data or the landmark
positions are changed. More information about these traits and how their presence is determined
is available via the <a href="#_hpo_browser">Human Phenotype Ontology (HPO) Browser</a>.
</p>

<h2 id="_hpo_browser">Human Phenotype Ontology (HPO) Browser</h2>
<p>The <em>HPO Browser</em> (shown below) can be accessed from the <em>Metrics</em> menu or by pressing <em>H</em>.
This dialog shows the table of HPO terms that Cliniface can detect <em>in principle</em>. That is, objective
criteria exist allowing Cliniface to evaluate associated facial measurements to establish whether
or not the HPO term should be flagged as present for the selected face (and current assessor's landmarks).
</p>
<center><img src="images/hpo_browser.png"/></center>
<p>As of version 5.0.0, Cliniface can detect 47 different HPO terms. HPO terms can be filtered by
anatomical region. The main table of the HPO browser
shows each term on its own row with the currently selected term highlighted. Click a different
row or use the up and down arrow keys to show information related to each term.
The columns from left to right respectively give the official
identifier, the name of the term, and the related measurements. Beneath the table are remarks about
the selected term including any synonyms plus any references. The first reference for every term
is always a link to the online website where complete and current information about the term can be found.
To the right of the remarks are the identifying criteria for the selected HPO term. The objective criteria
(what Cliniface uses) are shown above the subjective criteria (what a clinician might typically use).
</p>

<h2 id="_measurements_browser">Measurements Browser</h2>
<p>After detecting the face and placing landmarks, the <em>Measurements Browser</em> (shown below)
can be accessed from the <em>Metrics</em> menu, or by pressing <em>M</em>.
</p>
<center><img src="images/measurements_browser.png"/></center>

<p>Upon opening the <em>Measurements Browser</em>, the facial measurements are also visualised in the
main viewer on all loaded faces. Select a metric by clicking its row in the table or using the up
and down arrow keys. In the main viewer, the currently selected measurement is graphically highlighted
and the measurements themselves shown in the bottom left of the viewer. Some measurements are multi-dimensional
(e.g., asymmetry) with the values for each dimension shown from left to right in the
row marked "Measures". Measurements with associated growth curve data show the
corresponding z-scores underneath. Not all measurements have growth curve data, and most measurements
have growth curve data only for people of Caucasian or European ethnic descent. Future versions of Cliniface
will incorporate more growth curve norms from different ethnic groups.
</p>
<p>The table of measurements can be filtered by measurement type, anatomical region, and related HPO term
(filtering by related syndrome is currently disabled).
As of version 5.0.0, Cliniface makes five different types of measurement: Angle, Asymmetry, Depth, Distance,
and Region which are described in more detail <a href="#_metric_types">below</a>.
</p>

<h3>Automatic Statistics Matching</h3>
<p>By default, Cliniface tries to automatically match the demographics of the facial image to statistics
(growth curve data) from the set available for each metric. The closest match is used if an exact match isn't found,
but this may result in there being a demographic mismatch for the selected measurement. If this is the
case, the nature of the mismatch is shown in the bottom left of the main viewer.
</p>
<p>To disable automatic statistics matching, uncheck the <em>Automatch</em> checkbox in the measurements
browser. This enables manual selection of statistics for the currently selected metric using the
dropdown lists for sex, ethnicity, and source (where more than one source of growth curve data is
available for the selected sex / ethnicity combination). Checking the <em>Automatch</em> checkbox
resets the chosen statistics across <em>all measurements immediately</em>.
</p>

<h3>Growth Curve Charts</h3>
<p>To see a graph of the growth curve statistics for the selected measurement, click the graph icon in the bottom right
of the measurements browser to open the chart dialog. The graph that is displayed shows growth curve data for that
measurement and where the measurement for the subject sits according to the current positions of the associated landmarks.
The graph shows the mean of the measurement and plus/minus 1 and 2 standard deviations by age.
If the measurement is multi-dimensional, select which dimension to view from the dropdown list on
the bottom right of the chart dialog. Click the save icon to the left of this to save the chart in image or SVG format.
</p>
<p>While the chart dialog is open, selecting different measurements from the measurements browser shows the growth
curve data currently in use for that measurement. The image below shows the chart dialog with the <em>Nasal Protrusion</em>
measurement selected. Note that if the subject's age is out of range, the subject marker is not shown on the graph
(though it is still shown in the chart's key).
</p>
<center><img src="images/graph.png"/></center>

<h3>In-plane Measurements</h3>
<p>Cliniface takes measurements in 3D, but certain measurements (and types of metric) are defined only in two
dimensions. This is further complicated by the fact that growth curve statistics from different sources may
use different methodologies for the same measurement. This is often the case with distance measurements
between landmark pairs which are sometimes taken as point-to-point straight line distances (particularly
if taken from 3D images), while sometimes such distances have been taken manually which may cause the
measurement to be reported as shorter (i.e., measuring the adjacent leg of a right angle
triangle rather than the hypotenuse).
</p>
<p>The growth curve statistics in use for a given measurement specify whether those statistics have
been generated for that measurement "in-plane" (i.e., with the measurement projected to be parallel with
one of the cardinal facial planes: mid-sagittal, transverse, or coronal), or with no regard to the anatomical
planes. If there are two different sets of growth curve statistics for a measurement where only one
takes the measurement "in-plane", the measurement is taken in accordance with the method used to
generate the selected statistics. In the example below, the automatically matched statistics for
<em>Nasal Height</em> are from the <a href="https://facebase.org">FaceBase</a> website which
provides statistics for this measurement as a point-to-point distance between the subnasale
and nasion landmarks.
</p>
<center><img src="images/nasal_height_1.png"/></center>
<p>In the image below, selecting different statistics for this same measurement - this time from
Goodman and Gorlin (1977), Farkas (1981), and Saksena et al. (1987) - changes how the measurement
is taken to match the methodolgy used which in turn affects the distance measured which is now
parallel with the coronal plane.
</p>
<center><img src="images/nasal_height_2.png"/></center>
<p>If a measurement is taken "in-plane" due to the selected statistics (where it might nominally
be taken with no regard to the anatomical planes), this is indicated in the bottom left of the
main viewer with "[IN-PLANE]". To force all measurements to be taken in-plane, check the "in-plane"
checkbox. Note that this should only be used to experiment with the effect of forcing measurements
to be parallel with the anatomical facial planes. If the forced in-plane measurement does not
match the selected statistics for the measurement, this is indicated by "[IN-PLANE STATS MISMATCH]".
Note that the ability to force measurements to be in-plane can only be checked if automatching
is disabled.
</p>

<h3>Atypical Features</h3>
<p>Depressing the large warning triangle in the bottom right of the <em>Measurements Browser</em>
restricts the visible set of measurements to only those that are found to be atypical given
their currently set statistics. This also limits the list of terms in the <em>HPO Browser</em>
to just those that fulfill their objective criteria.
</p>

<h2 id="_metric_types">Metric Types</h2>
<p>Cliniface takes five different kinds of measurement which are calculated from the spatial positions
of the facial landmarks. Each metric type is described below in turn.
</p>
<h3>Angle</h3>
<p>Angle measurements are always taken parallel to one of the canonical anatomical facial planes.
They are defined by three points: two outer points and an inner point at which the angle is
measured as the arc subtended by the two line segments that meet at the inner point and with
end-points at the outer points. The angle is single dimensioned and is shown in degrees.
</p>
<h3>Asymmetry</h3>
<p>Asymmetry is measured as signed distance in the X, Y, and Z axes representing asymmetry through
the medial, transverse, and coronal planes respectively, and as overall magnitude (four dimensional).
For a bi-lateral landmark pair {p,q} with p on the right lateral and q on the left, calculation is as
follows: p is reflected through the medial plane to point p'. Difference vector d = q - p' is taken,
the components of which correspond to asymmetry along the respective axes. Magnitude is as the
L2 norm of d. Because the values corresponding to the axial components are signed, positive values
denote outgrowth in the positive halfspace (or ingrowth in the negative halfspace) through the respective plane.
</p>
<h3>Depth</h3>
<p>The dimension of depth measurements is not fixed. A depth measurement is taken from a point in space
above the surface of the face to the surface of the face. The direction in which depth is measured
depends upon the measurement but can be in-plane (parallel with an anatomical facial plane) in which
case the measurement is marked "[IN-PLANE]" in the bottom left of the main viewer or at right angles
to a line segment defined between two points.
</p>
<h3>Distance</h3>
<p>Distance measurements are one dimensional straight-line distances between pairs of points (generally
landmarks).
</p>
<h3>Region</h3>
<p>Region measurements are one dimensional and are a measure of the ratio of the square of a
region's perimeter with its area. Currently, the only region measurement in Cliniface
is <em>Upper Lip Circularity</em>.
</p>

<h2 id="_calliper_measurements">Calliper Measurements</h2>
<p>Cliniface allows users to place custom measurements between arbitrary pairs of points on the facial surface.
This is uses <em>virtual callipers</em> - a pair of points which can be dragged around over the model's surface
to measure distances (surface and straight line as well as their ratio), depth, angle, and cross-sectional area.
</p>
<p>To add a calliper measurement, right click on the model's surface and select <em>Add Calliper Measurement</em>.
Left-click and drag the end-points to move the measurement into position.
Depth and angle measurements are taken from the orange point on the surface between the two
end-points and the orange handle can be independently dragged anywhere along the surface path between the
two end-points.
</p>
<p>When the mouse is hovering over either of the red end-point handles, the direct (straight-line) distance
is shown next to the mouse cursor. When the mouse is over the orange handle, the depth to the surface
(taken at right angles to the straight line between the end-points) is shown next to the mouse cursor.
In both cases, a summary of all the measurements taken from the path is shown in the bottom right
of the viewer. The image below shows a custom measurement being drawn between two points.
</p>
<center><img src="images/max_calliper_1.png"/></center>
<p>When dragging the red end-point handles of a custom measurement, the orientation of the surface path (and the depth
and angle measurements) is recalculated given the camera's orientation. That is, the route the surface path
takes over the facial surface between the end-points is always coplanar with the camera's view vector.
After placing the path's end-points, moving the camera into a different position makes this clear and
allows for more informed placement of the orange handle for measuring depth and angle.
The same measurement as in the previous image is shown below but after adjusting the camera to view
the measurement from a different direction.
</p>
<p>If the measurement is placed so that the end-points are further back from the middle orange handle, the
point from which depth is measured will be behind the facial surface and the angle measurement will also
be behind the face. If this is the case, set the surface opacity to a value less than 1.0 the opacity
spinbox on the toolbar to see the measurements through the face.
</p>
<center><img src="images/max_calliper_2.png"/></center>
<p>The end-points of a measurement snap to landmarks if they are visible or to the end-points of other
custom measurements. If the end-points are snapping too readily to nearby landmarks, zoom in to
allow for the end-points to be placed closer to landmarks (or other measurement end-points) without
snapping.
</p>
<p>Custom measurements can be named by selecting the option to rename them when right clicking
on one of their handles (measurements are unnamed by default). The measurement name is saved
in the 3DF file format to allow for easy identification when using Cliniface to investigate new
facial measurements. Note that the full surface path of the measurement is only saved when
exporting data to XML/JSON format (from the <em>File</em>).
</p>


<br>
<hr>
<center>
<a href="#_top">Back to top</a>
<strong><p>&copy; 2018-2020 SIS Research Limited &amp; Richard Palmer</p></strong>
</center>

</body>
</html>
